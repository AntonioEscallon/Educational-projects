---
title: "Delomys Data Analysis"
author: "Antonio Escall√≥n"
date: "12/25/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

# Demolys Data Analysis {.tabset .tabset-pills}

## Data Exploration {.tabset}

### Demolys Data:
Here, we will be loading the Demolys Data and producing a summary of the body mass and body length data columns. 

```{r, echo=FALSE}
require(here)
delomys <- data.frame(read.csv(here("data","delomys.csv")))
head(delomys)
#Summary for body mass
summary(delomys$body_mass)
#Summary for body length
summary(delomys$body_length)
```

We will now perform a test of normality on the body mass and length columns using the shapiro test

``` {r, echo=FALSE}
#Creating a reduced data frame with only two columns
reduced <- delomys[, c("body_length", "body_mass")]
apply(reduced,2, shapiro.test)
```

### Graphical Exploration

```{r fig.width=10, echo=FALSE}
#Scatterplot of Body mass and body Length
plot(body_mass ~ body_length, data = delomys)
```

```{r fig.width=7, fig.height=5, echo=FALSE}
#Histogram of body mass
hist(delomys$body_mass, main="Histogram of Body Mass", xlab="Body Mass")
```

```{r fig.width=5, fig.height=3, echo=FALSE}
#Histogram of body length
hist(delomys$body_length, main="Histogram of Body Length", xlab="Body Length")
```

```{r fig.width=3, fig.height=4, echo=FALSE}
#Conditional box plot of body mass, conditioned on species
boxplot(body_mass~binomial, data=delomys, main="Conditional box plot of body mass and species", xlab="Species")
```
```{r fig.width=3, fig.height=4, echo=FALSE}
#Conditional box plot of body mass, conditioned on sex
boxplot(body_mass~sex, data=delomys, main="Conditional box plot of body mass and sex", xlab="Sex")
```
```{r fig.width=7, fig.height=7, echo=FALSE}
#Conditional box plot of body mass, conditioned on species and sex
boxplot(body_mass~binomial + sex, data=delomys, main="Conditional box plot of body mass vs species and sex", xlab="Species and Sex")
```

### Questions 1-4

* **Q1 (2 pts.): Qualitatively describe the relationship between body mass and length.**
  + Does the relationship seem linear, curved, nonexistent?
  + With the exception of some outliers, the relationship between body mass and length is clearly positively linear. By this I mean that the the more length we have the heavier we can expect animal to be. 

* **Q2 (2 pts.): Qualitatively describe the shapes of the histograms.**
  + Do the data appear normally-distributed? Explain why or why not.
  + Explain why we care (or not) whether the data are normally distributed.
  + The body mass histogram is normally distributed with a slight skew towards the right, meaning that most of the species is on the lighter side. The body length histogram is a lot less normally distributed, with a more aggressive skewing towards the right and a couple of real longer outliers in our data. Normal distribution in our data makes make the distribution explanation very easy since we only need the mean and the standard deviations to do so. In addition to making it easy to explain, it also makes it easy to preduct when using other models. 

* **Q3 (2 pts.): Using both the histograms and normality tests, do you think the (unconditioned) body masses and body length are normally-distributed?**
  + Make sure you contrast your visual assessment of normality to the results of the numerical normality tests.
  + If our null hypothesis is for normality, than both of the two histograms can reject the null hypothesis since they are both lower than 5%. That being said, there is a big difference between both. The body length histogram is not really normal and that is shown both by its shape and its low p value. In comparison, the body mass histogram has a much higher p value and, if we squint hard, could pass as a normal distribution graph. 

* **Q4 (2 pts.): Examine the three conditional boxplots.**
  + Describe any graphical evidence you see for body mass differences based on species and/or sex.
  + Dorsalis is the heavier species overall, and males in both species are the heaviest. I think whats most interesting is the number of outliers there are in both male species, and going even further, the number of outlines in the Delomys male species. It really makes me want to look further into why there are so many outliers in that species branch of animals.  

## Model Building {.tabset}

### Creaitng Models 1-5:

``` {r, echo=FALSE}
fit1 <- lm(body_length ~ body_mass, data=delomys)
fit2 <- aov(body_mass ~ sex, data=delomys)
fit3 <- aov(body_mass ~ binomial, data=delomys)
fit4 <-aov(body_mass ~ sex + binomial, data=delomys)
fit5 <- aov(body_mass ~ sex * binomial, data=delomys)
```

#### Model Diagnostics

We will now evaluate the assumption of normality of the models residuals by first having a graphical approach

```{r, fig.width=7, fig.height=3, echo=FALSE}
#Creating a histogram of each of the model resifduals
par(mfrow=c(1,3))
hist(residuals(fit1), main="Histogram of residuals", xlab="Linear Model")
hist(residuals(fit2), main="Histogram of residuals", xlab="Anova Sex")
hist(residuals(fit3), main="Histogram of residuals", xlab="Anova Species")
par(mfrow=c(1,2))
hist(residuals(fit4), main="Histogram of residuals", xlab="Anova Sex + Species")
hist(residuals(fit5), main="Histogram of residuals", xlab="Anova Sex * Species")
```

``` {r}
#Next we will use the shapiro test to see if we can reject our null hypothesis of the normality of residuals
shapiro.test(residuals(fit1))
shapiro.test(residuals(fit2))
shapiro.test(residuals(fit3))
shapiro.test(residuals(fit4))
shapiro.test(residuals(fit5))
```

### Questions 5-6 Model Assumptions

* **Q5 (2 pts.): What do you conclude about residual normality based on the numerical and graphical diagnostics?**
  + Its interesting what happens to my answer when I look at both the graphical and numerical diagnostics. At first glance, I would argue that only the linear model is the one that doesn't reside within the realm of data normality. The other graphs, especially both Two-Anova graphs really give a normal distribution feel to them. That being said, when we look at the p values of each, it is clear that fit2 is the one that gets the closest to normality since its p value is closest to 5%. Upon further analysis, I can see that fit2 is the one with the least amount of residuals and a good chunk of its data gravitating towards the "center" of the graph. That being said, all of the graphs would reject the null hypothesis. 

* **Q6 (1 pt.): Are violations of the normality assumption equally severe for all the models?**
  + They are not. As explained above, there is one true graph that really does not look normal, and the others could wear a coat and get past security. 

### Model Interpretation
  
```{r}
knitr::kable(coef(summary(fit1)), digits=3)
knitr::kable(coef(fit2), digits=3)
knitr::kable(coef(fit3), digits=3)
knitr::kable(coef(fit4), digits=3)
knitr::kable(coef(fit5), digits=3)
knitr::kable(anova(fit2), digits=3)
knitr::kable(anova(fit3), digits=3)
knitr::kable(anova(fit4), digits=3)
knitr::kable(anova(fit5), digits=3)
```

### Questions 7-9: Simple linear Regression


* **Q7 (2 pts.): What is the magnitude of the mass/length relationship?**
  +  There is a strong magnitude of the mass/length relationship, which means we can closley predict the mass of an animal witht a provided length

``` {r echo=FALSE}
#For the following quesitons we can use a graphical aid as follows
require(ggplot2)
mass_length<-ggplot(delomys, aes(x=body_mass, y=body_length))+
                     geom_point()

mass_length <- mass_length+ geom_smooth(method="lm", col="black")
mass_length
```

* **Q8 (2 pts.): What is the expected body length of an animal that weighs 100g?**
  + From the graph above and our previous numerical analysis we can see that the length of the animal will be ~163 when the body mass is 100g 
  
* **Q9 (2 pts.): What is the expected body length of an animal that weighs 0g?**
  + Its hard to get the y-intercept from the graph, but we can go back to the table we created and see that the value will be of 76.125	

### Questions 10-13: Body Mass: Coefficient Tables

``` {r}
knitr::kable(coef(fit2), digits=3)
knitr::kable(coef(fit3), digits=3)
knitr::kable(coef(fit4), digits=3)
knitr::kable(coef(fit5), digits=3)
```

* **Q10 (1 pt.): What is the base level for sex?** 
  + 42.711
* **Q11 (1 pt.): What is the base level for binomial?**
  + 46.752
* **Q12 (1 pt.): Which sex is heavier? How do you know?**
  + The male sex from the provided sexmale variable in the coefficient table of the fit4 model. 
* **Q13 (1 pt.): Which species is heavier? How do you know?**
  + The Dorsalis species is heavier. We know this from the negative variable given to the sublineatus speciesprovided by the coefficient table of the fit5 model. 
  
### Questions 14-16: ANOVA Tables

``` {r}
knitr::kable(anova(fit2), digits=3)
knitr::kable(anova(fit3), digits=3)
knitr::kable(anova(fit4), digits=3)
knitr::kable(anova(fit5), digits=3)
```

* **Q14 (1 pt.): Are sex and species significant predictors for body mass?**
  + From what we've seen all along and with the output of this data, we can say that they are significant predictors for body mass
* **Q15 (1 pt.): Is there a significant interaction?**
  + There is a significant interaction on both sex and species. 
* **Q16 (2 pts.): Examine the p-values for the main effects (sex and species) in all four of the ANOVA tables. Does the significance level of either main effect change very much among the different models?**
  + Yes, they do chance significantly among the different models. Most importantly, they really increase on the fifth model by sex of each species. 
  
### Q17-18: Model Comparison

``` {r}
#Calculating the AIC
AIC(fit1)
AIC(fit2)
AIC(fit3)
AIC(fit4)
AIC(fit5)
```
* **Q17 (1 pt.): Which two models have the lowest AIC?**
  + From what we've seen all along and with the output of this data, we can say that they are significant predictors for body mass. 
  + The linear model and the anova model that only uses the species variable. 
* **18 (4 pts.): Which of the two models with lowest AIC scores would you select?**
  + Explain your decision based on model fit and the complexity/understanding tradeoff.
  + I would definitely select the linear model. Even before knowing the AIC numbers, I had made this decision. I have a lot more experience tinkering with linear models in R and making predictive models with it. In addition to that, the linear model fits pretty well for whatever our future work would b (i.e. making a predictive model). I discovered anova models in this class, so I feel a lot less comfortable with them and am still learning how it all works, which for me is part of the complexity/understanding tradeoff. 

